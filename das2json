#!/usr/bin/env python3
"""das2json - Convert diagram to JSON using Node.js"""

import os
import sys
import subprocess
from pathlib import Path


def main():
    if len(sys.argv) != 2:
        print(f"Usage: {sys.argv[0]} <diagram-file>", file=sys.stderr)
        sys.exit(1)
    
    pbp = os.environ.get("PBP")
    if not pbp:
        print("Error: PBP environment variable not set", file=sys.stderr)
        sys.exit(1)
    
    das2json_script = Path(pbp) / "das" / "das2json.mjs"
    diagram_file = sys.argv[1]
    
    try:
        subprocess.run(
            ["node", str(das2json_script), diagram_file],
            check=True
        )
    except subprocess.CalledProcessError as e:
        sys.exit(e.returncode)
    except FileNotFoundError:
        print("Error: 'node' command not found. Please install Node.js.", file=sys.stderr)
        sys.exit(1)


if __name__ == "__main__":
    main()
